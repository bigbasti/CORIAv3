<div class="page-header">
    <div class="row">
        <div class="col-md-10"><h1>Dataset <small>{{$ctrl.dataset.name}}</small></h1></div>
        <div class="col-md-2" ng-show="$ctrl.isDatasetRefreshing">
            <!--<span class="glyphicon glyphicon-time" aria-hidden="true"></span> <span>Loading DataSet, please wait...</span>-->
            <div class="progress" style="margin-top: 25px;">
                <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="row" ng-hide="$ctrl.displayAddMetric === true">
            <div class="col-md-12">
                <div class="row">
                    <div class="col-md-10"><h3>Available Metrics</h3></div>
                    <div class="col-md-2">
                        <div class="progress" ng-show="$ctrl.isMetricRefreshing">
                            <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                <table st-table="$ctrl.displayedCollection" st-safe-src="$ctrl.dataset.metricInfos" class="table table-striped">
                    <thead>
                    <tr>
                        <th st-sort="name">Short</th>
                        <th st-sort="created">Name</th>
                        <th st-sort="notificationEmails">State</th>
                        <th st-sort="metrics">Info</th>
                        <th>Result</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="metric in $ctrl.displayedCollection">
                        <td><span class="label label-primary">{{metric.shortcut}}</span></td>
                        <td>{{metric.name}}</td>
                        <td ng-if="metric.status==='FINISHED'"><span class="label label-success">SUCCESSFUL</span></td>
                        <td ng-if="metric.status==='RUNNING'"><span class="label label-warning">IN PROGRESS</span></td>
                        <td ng-if="metric.status==='FAILED'"><span class="label label-danger">FAILED</span></td>
                        <td ng-if="metric.executionFinished">{{(metric.executionFinished - metric.executionStarted) | duration}}</td>
                        <td ng-if="!metric.executionFinished">{{($ctrl.currentTime - metric.executionStarted) | duration}}</td>
                        <td ng-if="metric.type!=='DATASET'"><span >N/A</span></td>
                        <td ng-if="metric.type==='DATASET'"><span >{{metric.value}}</span></td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="5" class="text-center">
                            <div st-pagination="" st-items-by-page="$ctrl.datasetsPerPage" st-displayed-pages="10"></div>
                        </td>
                    </tr>
                    </tfoot>
                </table>
                <!--<p ng-repeat="metric in $ctrl.dataset.metricInfos">-->
                    <!--<span class="label label-primary">{{metric.shortcut}}</span> <span>{{metric.name}}</span> <span class="label label-danger" ng-if="metric.executionFinished===null" alt="Running for">IN PROGRESS</span>-->
                <!--</p>-->
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <button class="btn btn-default btn-xs"  ng-click="$ctrl.displayAddMetric = true" ng-hide="$ctrl.displayAddMetric === true"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add Metric</button>
            </div>
        </div>
        <div class="row" ng-show="$ctrl.displayAddMetric === true">
            <div class="col-md-12">
                <div class="alert alert-info" role="alert" ng-bind-html="$ctrl.metric.description"></div>
                <form name="import" id="import" ng-submit="$ctrl.submitMetric()" >
                    <div class="form-group">
                        <label for="metric.providers">Select Metric</label>
                        <select class="form-control" ng-model="$ctrl.selectedMetric" id="metric.providers" ng-change="$ctrl.metricProviderSelected()">
                            <option ng-repeat="metric in $ctrl.metrics" value="{{metric.identification}}">{{metric.technology}} - {{metric.provider}} - {{metric.name}}</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-default" ng-hide="$ctrl.import.isActive" ng-disabled="$ctrl.metric.identification === undefined"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Start Metric Execution</button>
                    <button class="btn btn-default" ng-hide="$ctrl.import.isActive" ng-click="$ctrl.cancelAddMetric()"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Cancel</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="row">
            <div class="col-md-12">
                <div class="row">
                    <div class="col-md-10"><h3>Nodes</h3></div>
                    <div class="col-md-2">
                        <div class="progress" ng-show="$ctrl.isNodesRefreshing">
                            <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                <table st-table="$ctrl.displayedCollectionNodes" st-safe-src="$ctrl.dataset.nodes" class="table table-striped">
                    <thead>
                    <tr>
                        <th st-sort="name">Name</th>
                        <th st-sort="riscScore">Risc Score</th>
                        <th ng-repeat="(key, value) in $ctrl.dataset.nodes[0].attributes" ng-if="key.indexOf('_')<0">{{$ctrl.getMetricByShortcut(key)}}</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="node in $ctrl.displayedCollectionNodes">
                        <td>{{node.name}}</td>
                        <td>{{node.riscScore}}</td>
                        <td ng-repeat="(key, value) in node.attributes" ng-if="key.indexOf('_')<0">
                            {{value}} <span class="label label-info" ng-repeat="sm in $ctrl.getSubMetrics(node, key)">{{sm}}</span>
                        </td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="5" class="text-center">
                            <div st-pagination="" st-items-by-page="$ctrl.datasetsPerPage" st-displayed-pages="10"></div>
                        </td>
                    </tr>
                    </tfoot>
                </table>
                <!--<p ng-repeat="metric in $ctrl.dataset.metricInfos">-->
                <!--<span class="label label-primary">{{metric.shortcut}}</span> <span>{{metric.name}}</span> <span class="label label-danger" ng-if="metric.executionFinished===null" alt="Running for">IN PROGRESS</span>-->
                <!--</p>-->
            </div>
        </div>
    </div>
</div>